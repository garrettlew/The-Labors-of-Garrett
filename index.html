<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title> What I'll Do to Get into UCLA </title>
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<script type="text/javascript" src="https://ajax.microsoft.com/ajax/jQuery/jquery-1.4.2.min.js"></script>
	
</head>
<body>

<h1>What I'll do to get into UCLA</h1>
<p> by: Garrett Lew </p>

<canvas id="myCanvas" width="1074" height= "576" style="border: 1px solid#000;"></canvas>

<script>

	//LOAD JS Files
	function loadScript(src){
		var el = document.createElement("script");
		el.src = src;
		document.body.appendChild(el);
	}

	loadScript("js/fountain.js");
	loadScript("js/desert.js");
	loadScript("js/redouble.js");

	//LOADING IMAGES
	var invertedFountain = new Image();
	invertedFountain.src = "images/inverted_fountain2.jpg";

	var uclaBackground = new Image();
	uclaBackground.src = "images/ucla_background.jpg";

	var redoubleBackground = new Image();
	redoubleBackground.src = "images/redouble_bg.jpg";

	//LEVELS
	var levelSelector = {
		level0: 0,
		level1: 1,
		level2: 2,
	};

	var currentLevel = levelSelector.level1;

	//to know which level to go back to when go to redouble
	var previousLevel = currentLevel;

	function nextLevel() {
		currentLevel++;
	}

	//KeyCodes
	var KEY_LEFT=37, KEY_UP=38, KEY_RIGHT=39, KEY_DOWN=40, SPACE=32, KEY_P=80;
	//WASD
	var KEY_A=65, KEY_D=68, KEY_S=83, KEY_W=87;

	//booleans to hold the state of keys
	var UpPressed = false, LeftPressed = false, RightPressed = false, DownPressed = false; KeyPressed = false;

	var canvas = document.getElementById('myCanvas');
	var ctx = canvas.getContext('2d');

	function eraseCanvas() {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
	}

	$('body').keyup(function(event) {
		if (event.keyCode === KEY_UP || event.keyCode === KEY_W) {
			UpPressed = false;
		}
		if (event.keyCode === KEY_LEFT || event.keyCode === KEY_A) {
			LeftPressed = false;
		}
		if (event.keyCode === KEY_RIGHT || event.keyCode === KEY_D) {
			RightPressed = false;
		}

		//redouble
		if (currentLevel === levelSelector.level0) {
			KeyPressed = true;
		}

		//pause
		if (event.keyCode === KEY_P) {
			alert("You have paused the game.");
		}
		//restart the game
		if (event.keyCode === SPACE) {
			location.reload();
		}
	});

	$('body').keydown(function(event) {

		if (currentLevel === levelSelector.level1) {
			if (event.keyCode === KEY_UP && player1.grounded || event.keyCode === KEY_W && player1.grounded) {
				UpPressed = true;
			}
			if (event.keyCode === KEY_LEFT && player1.x >= 0 || event.keyCode === KEY_A && player1.x >= 0) {
				LeftPressed = true;
			}
			if (event.keyCode === KEY_RIGHT && player1EdgeX <= canvas.width || event.keyCode === KEY_D && player1EdgeX <= canvas.width ) {
				RightPressed = true;
			}
			if (event.keyCode === KEY_DOWN && player1EdgeY <= canvasEdgeHeight || event.keyCode === KEY_S && player1EdgeY <= canvasEdgeHeight ) {
				DownPressed = true;
			}
		}

		if (currentLevel === levelSelector.level2) {
			if (event.keyCode === KEY_UP && player.grounded || event.keyCode === KEY_W && player.grounded) {
				UpPressed = true;
			}
			if (event.keyCode === KEY_LEFT && player.x >= 0 || event.keyCode === KEY_A && player.x >= 0) {
				LeftPressed = true;
			}
			if (event.keyCode === KEY_RIGHT && playerEdgeX <= canvas.width || event.keyCode === KEY_D && playerEdgeX <= canvas.width ) {
				RightPressed = true;
			}
			if (event.keyCode === KEY_DOWN && playerEdgeY <= canvasEdgeHeight || event.keyCode === KEY_S && playerEdgeY <= canvasEdgeHeight ) {
				DownPressed = true;
			}
		}

	});

	//Uses sudo finite state machine
	var gameLoop = function() {

		eraseCanvas();

		if (currentLevel === levelSelector.level1) {

			checkEndZone();
			player1.move();
			player1.update();
			drawFtnMap();


		} else if (currentLevel === levelSelector.level2) {

			if (currentLevel != previousLevel) {
				previousLevel = currentLevel;
			}

			player.checkIfDonezo();
			player.move();
			player.update();
			player.playerInviciblility();
			spawnObstacle();
			obstacleChecks();

			drawDesert();
		} else if (currentLevel === levelSelector.level0) {
			runRedouble();
		}

	}

	//dont need () after gameLoop
	setInterval(gameLoop, 30);	


</script>

</body>
</html>